# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

# static analysis

parameters:
  BuildConfiguration: ''
  VmImage: ''

jobs:
- job:
  displayName: Static Analysis
  pool:
    vmImage: '${{ parameters.VmImage }}'

  steps:
  - task: NuGetAuthenticate@1
    displayName: 'NuGet Authenticate'

  - checkout: self  # self represents the repo where the initial Pipelines YAML file was found
    clean: true  # if true, execute `execute git clean -ffdx && git reset --hard HEAD` before fetching

  - task: UseDotNet@2
    displayName: Setup .NET SDK v6.0.x
    inputs:
      packageType: sdk
      version: 6.0.x

  - task: CodeQL3000Init@0
    displayName: 'CodeQL Init'
    inputs:
      Enabled: true

  - task: DotNetCoreCLI@2
    displayName: Build Azure.DataApiBuilder.sln
    inputs:
      command: build
      projects: 'src/Azure.DataApiBuilder.sln'
      configuration: '${{ parameters.BuildConfiguration }}'
      publishTestResults: true

  - task: CodeQL3000Finalize@0
    displayName: 'CodeQL Finalize'
    condition: always()